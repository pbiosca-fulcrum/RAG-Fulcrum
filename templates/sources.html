{% extends "base.html" %}

{% block title %}Source Documents - TheFulcrum's Chat{% endblock %}

{% block content %}
  {% if last_query %}
    <p style="font-weight:bold;">These are the documents used to construct your latest query:</p>
    <p style="margin-bottom:25px;">"{{ last_query }}"</p>
  {% else %}
    <p>No record of your last query was found.</p>
  {% endif %}

  {% if sources %}
    {% for source in sources %}
      <div class="source-item">
        <h2>{{ source.title }}</h2>

        {# Uncomment if you want to show Relevance Score #}
        {# 
        <div class="relevance-section">
          Relevance Score:
          <span class="similarity-score"
                style="color:{% if source.score >= 80 %}green{% elif source.score >= 60 %}darkorange{% elif source.score >= 40 %}#e38f19{% elif source.score >= 20 %}#cc4141{% else %}red{% endif %};">
            {{ source.score }}%
          </span>
        </div>
        #}

        {% if source.type == "document" %}
          <p>
            <a href="{{ source.link }}" target="_blank">View Original Document</a>
          </p>
        {% elif source.type == "wiki" %}
          <p>
            <a href="{{ source.view_link }}" target="_blank">View Wiki Page</a>
            {% if source.edit_link %}
              | <a href="{{ source.edit_link }}" target="_blank">Edit Wiki Page</a>
            {% endif %}
          </p>
          <h3>Preview (first 500 characters):</h3>
          <div class="source-content">
            {{ source.full_text }}
          </div>
        {% endif %}
      </div>
    {% endfor %}
  {% else %}
    <p>No source documents available.</p>
  {% endif %}

  <p><a href="/" class="btn">Back to Chat</a></p>
{% endblock %}
